\input{newcommands}

It was shown in \cite{Vaypop2008} that the Boris formulation is
not Lorentz invariant and can lead to significant errors in the treatment
of relativistic dynamics. A Lorentz invariant formulation is obtained
by considering the following velocity average 
\begin{align}
\mathbf{\bar{v}}^{i}= & \frac{\mathbf{v}^{i+1/2}+\mathbf{v}^{i-1/2}}{2},\label{Eq:new_v}
\end{align}
This gives a system that is solvable analytically (see \cite{Vaypop2008}
for a detailed derivation), giving the following velocity update:

\begin{subequations}
\begin{align}
\mathbf{u^{*}}= & \mathbf{u}^{i-1/2}+\frac{q\Delta t}{m}\left(\mathbf{E}^{i}+\frac{\mathbf{v}^{i-1/2}}{2}\times\mathbf{B}^{i}\right),\label{pusher_gamma}\\
\mathbf{u}^{i+1/2}= & \left[\mathbf{u^{*}}+\left(\mathbf{u^{*}}\cdot\mathbf{t}\right)\mathbf{t}+\mathbf{u^{*}}\times\mathbf{t}\right]/\left(1+t^{2}\right),\label{pusher_upr}
\end{align}
\end{subequations}
where $\mathbf{t}=\bm{\tau}/\gamma^{i+1/2}$, $\bm{\tau}=\left(q\Delta t/2m\right)\mathbf{B}^{i}$,
$\gamma^{i+1/2}=\sqrt{\sigma+\sqrt{\sigma^{2}+\left(\tau^{2}+w^{2}\right)}}$,
$w=\mathbf{u^{*}}\cdot\bm{\tau}$, $\sigma=\left(\gamma'^{2}-\tau^{2}\right)/2$
and $\gamma'=\sqrt{1+(\mathbf{u}^{*}/c)^{2}}$. This Lorentz invariant formulation
is particularly well suited for the modeling of ultra-relativistic
charged particle beams, where the accurate account of the cancellation
of the self-generated electric and magnetic fields is essential, as
shown in \cite{Vaypop2008}.
