dist: xenial
language: c++
sudo: true

env:
  matrix:
    - WARPX_TEST_DIM=3 HAS_QED=FALSE
    - WARPX_TEST_DIM=2 HAS_QED=FALSE
    - HAS_QED=TRUE

before_install:
    - sudo apt-get update
    - sudo apt-get install -y gcc gfortran g++ openmpi-bin libopenmpi-dev libfftw3-dev libfftw3-mpi-dev
    # Install miniconda and python dependencies
    - wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    - bash Miniconda3-latest-Linux-x86_64.sh -b
    - export PATH=/home/travis/miniconda3/bin:$PATH
    - pip install --upgrade pip && pip install numpy scipy matplotlib yt mpi4py
    # Install an up-to-date version of the Boost library (>= 1.67 should be ok)
    - if [ $HAS_QED = "TRUE" ]; then wget https://dl.bintray.com/boostorg/release/1.71.0/source/boost_1_71_0.tar.gz ; fi
    - if [ $HAS_QED = "TRUE" ]; then  tar xf boost_1_71_0.tar.gz ; fi
    - if [ $HAS_QED = "TRUE" ]; then  cd boost_1_71_0 ; fi
    - if [ $HAS_QED = "TRUE" ]; then  ./bootstrap.sh --with-libraries=math ; fi
    - if [ $HAS_QED = "TRUE" ]; then  sudo ./b2 -d0 install ; fi
    - if [ $HAS_QED = "TRUE" ]; then  cd .. ; fi

script:
    - export FFTW_HOME=/usr/
    - export OMP_NUM_THREADS=1
    # Run the tests on the current commit
    - export WARPX_TEST_COMMIT=$TRAVIS_COMMIT
    # Run the script that prepares the test environment and runs the tests
    - ./run_test.sh
